#!/usr/bin/env ruby

require "./lib/availability"
require "json"
require "time"

TIME_FORMAT = "%H:%M:%S"

file = File.read('./availability_slots.json')
data = JSON.parse(file)
appointments  = data["availability_slots"]
booked_appointments = []
time_format = /^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0]$/

loop do
puts "What time would you like to book?"
user_input = gets

while !time_format.match(user_input)
  puts "Invalid time format! Make sure you use ':' & select a time that is on the hour or at 10 minute intervals after."
  user_input = gets
end

request = Time.parse(user_input).strftime(TIME_FORMAT)

puts "Your booking is at:-"
puts Availability.new(appointments, booked_appointments).find_availability(request)
end
